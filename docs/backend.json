{
  "entities": {
    "BlogPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BlogPost",
      "type": "object",
      "description": "Represents a blog post entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the BlogPost entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the blog post."
        },
        "content": {
          "type": "string",
          "description": "The full content of the blog post in Markdown format."
        },
        "category": {
          "type": "string",
          "description": "The category of the blog post."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the main image for the blog post."
        },
        "imageHint": {
          "type": "string",
          "description": "A hint for AI to find a relevant image."
        },
        "excerpt": {
          "type": "string",
          "description": "A short summary or excerpt of the blog post."
        },
        "authorId": {
          "type": "string",
          "description": "The ID of the user who authored the post."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time the blog post was created."
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time the blog post was last updated."
        }
      },
      "required": ["id", "title", "content", "authorId", "createdAt", "updatedAt"]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the EnTrans application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user, which determines their access level.",
          "enum": ["administrador", "treballador", "client/proveidor", "extern"]
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time the user profile was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "role"
      ]
    },
    "RegistrationRequest": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "RegistrationRequest",
        "type": "object",
        "description": "Represents a request for a new user account.",
        "properties": {
            "id": { "type": "string", "description": "Unique ID for the request." },
            "firstName": { "type": "string" },
            "lastName": { "type": "string" },
            "email": { "type": "string", "format": "email" },
            "status": { "type": "string", "enum": ["pending"] },
            "requestedAt": { "type": "string", "format": "date-time" }
        },
        "required": ["firstName", "lastName", "email", "status", "requestedAt"]
    },
    "TransportRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TransportRequest",
      "type": "object",
      "description": "Represents a transport request made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TransportRequest entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N TransportRequest)"
        },
        "transportType": {
          "type": "string",
          "description": "The type of transport requested (e.g., 'cargo')."
        },
        "origin": {
          "type": "string",
          "description": "The origin location of the transport."
        },
        "destination": {
          "type": "string",
          "description": "The destination location of the transport."
        },
        "departureDate": {
          "type": "string",
          "description": "The requested departure date.",
          "format": "date-time"
        },
        "arrivalDate": {
          "type": "string",
          "description": "The requested arrival date.",
          "format": "date-time"
        },
        "specialRequirements": {
          "type": "string",
          "description": "Any special requirements for the transport."
        },
        "status": {
          "type": "string",
          "description": "The status of the transport request (e.g., 'pending', 'matched', 'accepted', 'completed')."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "transportType",
        "origin",
        "destination",
        "departureDate"
      ]
    },
    "TransportOffering": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TransportOffering",
      "type": "object",
      "description": "Represents a transport offering made by a transport provider.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TransportOffering entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N TransportOffering)"
        },
        "transportType": {
          "type": "string",
          "description": "The type of transport offered (e.g., 'cargo')."
        },
        "origin": {
          "type": "string",
          "description": "The origin location of the transport offering."
        },
        "destination": {
          "type": "string",
          "description": "The destination location of the transport offering."
        },
        "departureDate": {
          "type": "string",
          "description": "The departure date of the transport offering.",
          "format": "date-time"
        },
        "arrivalDate": {
          "type": "string",
          "description": "The arrival date of the transport offering.",
          "format": "date-time"
        },
        "capacity": {
          "type": "number",
          "description": "The capacity of the transport offering (e.g., cargo weight)."
        },
        "price": {
          "type": "number",
          "description": "The price of the transport offering."
        },
        "vehicleDetails": {
          "type": "string",
          "description": "Details about the vehicle used for the transport offering."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "transportType",
        "origin",
        "destination",
        "departureDate",
        "capacity",
        "price"
      ]
    },
    "TransportMatch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TransportMatch",
      "type": "object",
      "description": "Represents a match between a TransportRequest and a TransportOffering.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TransportMatch entity."
        },
        "transportRequestId": {
          "type": "string",
          "description": "Reference to TransportRequest. (Relationship: TransportRequest 1:N TransportMatch)"
        },
        "transportOfferingId": {
          "type": "string",
          "description": "Reference to TransportOffering. (Relationship: TransportOffering 1:N TransportMatch)"
        },
        "matchScore": {
          "type": "number",
          "description": "The score representing the quality of the match (higher is better)."
        },
        "matchDate": {
          "type": "string",
          "description": "The date and time the match was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "transportRequestId",
        "transportOfferingId",
        "matchScore"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The 'userId' parameter is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
          "path": "/registrationRequests/{requestId}",
          "definition": {
              "entityName": "RegistrationRequest",
              "schema": { "$ref": "#/backend/entities/RegistrationRequest" },
              "description": "Stores new user registration requests pending admin approval."
          }
      },
      {
        "path": "/users/{userId}/transportRequests/{transportRequestId}",
        "definition": {
          "entityName": "TransportRequest",
          "schema": {
            "$ref": "#/backend/entities/TransportRequest"
          },
          "description": "Stores transport requests made by a user.  The 'userId' parameter is the Firebase Auth UID, enforcing ownership. The 'transportRequestId' is the unique ID of the transport request.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who created the request."
            },
            {
              "name": "transportRequestId",
              "description": "The unique ID of the transport request."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transportOfferings/{transportOfferingId}",
        "definition": {
          "entityName": "TransportOffering",
          "schema": {
            "$ref": "#/backend/entities/TransportOffering"
          },
          "description": "Stores transport offerings made by transport providers. The 'userId' parameter is the Firebase Auth UID, enforcing ownership. The 'transportOfferingId' is the unique ID of the transport offering.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who created the offering."
            },
            {
              "name": "transportOfferingId",
              "description": "The unique ID of the transport offering."
            }
          ]
        }
      },
      {
        "path": "/transportMatches/{transportMatchId}",
        "definition": {
          "entityName": "TransportMatch",
          "schema": {
            "$ref": "#/backend/entities/TransportMatch"
          },
          "description": "Stores matches between transport requests and transport offerings. Includes denormalized 'userProfileId' from both TransportRequest and TransportOffering for authorization independence in security rules.",
          "params": [
            {
              "name": "transportMatchId",
              "description": "The unique ID of the transport match."
            }
          ]
        }
      },
      {
        "path": "/blogPosts/{blogPostId}",
        "definition": {
          "entityName": "BlogPost",
          "schema": {
            "$ref": "#/backend/entities/BlogPost"
          },
          "description": "Stores blog post articles.",
          "params": [
            {
              "name": "blogPostId",
              "description": "The unique ID of the blog post."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the EnTrans application's core features, including transport requests, offerings, and matching. It prioritizes authorization independence and clear security rules by adhering to the principles outlined in the prompt. User profiles are stored under the `/users/{userId}` path, providing clear ownership. Transport requests and offerings are stored as subcollections of user profiles (`/users/{userId}/transportRequests` and `/users/{userId}/transportOfferings`), reinforcing ownership and enabling simple security rules based on `request.auth.uid == userId`. Transport matches are stored in a top-level `/transportMatches` collection. To ensure authorization independence, the `userProfileId` of both the `TransportRequest` and `TransportOffering` are denormalized into each `TransportMatch` document. This avoids the need for complex `get()` calls in the security rules to verify ownership. A new top-level collection `/blogPosts` has been added to store blog articles. This design facilitates secure list operations (QAPs) by segregating data based on ownership. Each user can only list transport requests and offerings under their own user ID, ensuring that they cannot access data they are not authorized to see. The membership map approach is not applicable here, as there is no collaborative data."
  }
}
